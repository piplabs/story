syntax = "proto3";
package story.dkg.v1.types;

import "gogoproto/gogo.proto";

option go_package = "github.com/piplabs/story/client/x/dkg/types";

enum DKGRegStatus {
  option (gogoproto.goproto_enum_prefix) = false;

  DKG_REG_STATUS_UNSPECIFIED = 0 [(gogoproto.enumvalue_customname) = "DKGRegStatusUnspecified"];
  DKG_REG_STATUS_VERIFIED = 1 [(gogoproto.enumvalue_customname) = "DKGRegStatusVerified"];
  DKG_REG_STATUS_FINALIZED = 2 [(gogoproto.enumvalue_customname) = "DKGRegStatusFinalized"];
}

enum DKGStage {
  option (gogoproto.goproto_enum_prefix) = false;

  DKG_STAGE_UNSPECIFIED = 0 [(gogoproto.enumvalue_customname) = "DKGStageUnspecified"];
  DKG_STAGE_REGISTRATION = 1 [(gogoproto.enumvalue_customname) = "DKGStageRegistration"];
  DKG_STAGE_DEALING = 2 [(gogoproto.enumvalue_customname) = "DKGStageDealing"];
  DKG_STAGE_FINALIZATION = 3 [(gogoproto.enumvalue_customname) = "DKGStageFinalization"];
  DKG_STAGE_ACTIVE = 4 [(gogoproto.enumvalue_customname) = "DKGStageActive"];
  DKG_STAGE_FAILED = 5 [(gogoproto.enumvalue_customname) = "DKGStageFailed"];
}

message DKGNetwork {
  bytes code_commitment = 1 [
    (gogoproto.moretags) = "yaml:\"code_commitment\""
  ];

  uint32 round = 2 [
    (gogoproto.moretags) = "yaml:\"round\""
  ];

  int64 start_block_height = 3 [
    (gogoproto.moretags) = "yaml:\"start_block_height\""
  ];

  bytes start_block_hash = 4 [
    (gogoproto.moretags) = "yaml:\"start_block_hash\""
  ];

  // list of active validators' evm addresses
  repeated string active_val_set = 5 [
    (gogoproto.moretags) = "yaml:\"active_val_set\""
  ];

  uint32 total = 6 [
    (gogoproto.moretags) = "yaml:\"total\""
  ];

  uint32 threshold = 7 [
    (gogoproto.moretags) = "yaml:\"threshold\""
  ];

  DKGStage stage = 8 [
    (gogoproto.moretags) = "yaml:\"stage\""
  ];

  bool is_resharing = 9 [
    (gogoproto.moretags) = "yaml:\"is_resharing\""
  ];

  bytes global_public_key = 10 [
    (gogoproto.moretags) = "yaml:\"global_public_key\""
  ];

  repeated bytes public_coeffs = 11 [
    (gogoproto.moretags) = "yaml:\"public_coeffs\""
  ];
}

message DKGRegistration {
  uint32 round = 1 [
    (gogoproto.moretags) = "yaml:\"round\""
  ];

  string validator_addr = 2 [
    (gogoproto.moretags) = "yaml:\"validator_addr\""
  ];

  uint32 index = 3 [
    (gogoproto.moretags) = "yaml:\"index\""
  ];

  bytes dkg_pub_key = 4 [
    (gogoproto.moretags) = "yaml:\"dkg_pub_key\""
  ];

  bytes comm_pub_key = 5 [
    (gogoproto.moretags) = "yaml:\"comm_pub_key\""
  ];

  bytes raw_quote = 6 [
    (gogoproto.moretags) = "yaml:\"raw_quote\""
  ];

  DKGRegStatus status = 7 [
    (gogoproto.moretags) = "yaml:\"status\""
  ];
}

message TEEUpgradeInfo {
  bytes code_commitment = 1 [
    (gogoproto.moretags) = "yaml:\"code_commitment\""
  ];

  int64 activation_height = 2 [
    (gogoproto.moretags) = "yaml:\"activation_height\""
  ];
}


message EncryptedDeal {
  bytes dh_key = 1 [
    (gogoproto.moretags) = "yaml:\"dh_key\""
  ];

  bytes signature = 2 [
    (gogoproto.moretags) = "yaml:\"signature\""
  ];

  bytes nonce = 3 [
    (gogoproto.moretags) = "yaml:\"nonce\""
  ];

  bytes cipher = 4 [
    (gogoproto.moretags) = "yaml:\"cipher\""
  ];
}

message Deal {
  uint32 index = 1 [
    (gogoproto.moretags) = "yaml:\"index\""
  ];

  uint32 recipient_index = 2 [
    (gogoproto.moretags) = "yaml:\"recipient_index\""
  ];

  EncryptedDeal deal = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.moretags) = "yaml:\"deal\""
  ];

  bytes signature = 4 [
    (gogoproto.moretags) = "yaml:\"signature\""
  ];
}

message Complaint {
  uint32 dealer_index = 1 [
    (gogoproto.moretags) = "yaml:\"dealer_index\""
  ];

  bytes signature = 2 [
    (gogoproto.moretags) = "yaml:\"signature\""
  ];
}

message DecryptRequest {
  string requester = 1 [
    (gogoproto.moretags) = "yaml:\"requester\""
  ];

  uint32 round = 2 [
    (gogoproto.moretags) = "yaml:\"round\""
  ];

  bytes code_commitment = 3 [
    (gogoproto.moretags) = "yaml:\"code_commitment\""
  ];

  bytes ciphertext = 4 [
    (gogoproto.moretags) = "yaml:\"ciphertext\""
  ];

  bytes label = 5 [
    (gogoproto.moretags) = "yaml:\"label\""
  ];

  // secp256k1 uncompressed requester pubkey (65 bytes)
  bytes requester_pub_key = 6 [
    (gogoproto.moretags) = "yaml:\"requester_pub_key\""
  ];
}

message Response {
  uint32 index = 1 [
    (gogoproto.moretags) = "yaml:\"index\""
  ];

  VSSResponse vss_response = 2 [
    (gogoproto.moretags) = "yaml:\"vss_response\""
  ];
}

message VSSResponse {
  bytes session_id = 1 [
    (gogoproto.moretags) = "yaml:\"session_id\""
  ];

  uint32 index = 2 [
    (gogoproto.moretags) = "yaml:\"index\""
  ];

  bool status = 3 [
    (gogoproto.moretags) = "yaml:\"status\""
  ];

  bytes signature = 4 [
    (gogoproto.moretags) = "yaml:\"signature\""
  ];
}

message Scalar {
  bytes data = 1 [
    (gogoproto.moretags) = "yaml:\"data\""
  ];
}

message Point {
  bytes data = 1 [
    (gogoproto.moretags) = "yaml:\"data\""
  ];
}
