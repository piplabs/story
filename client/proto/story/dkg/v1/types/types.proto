syntax = "proto3";
package story.dkg.v1.types;

import "gogoproto/gogo.proto";

option go_package = "github.com/piplabs/story/client/x/dkg/types";

enum DKGRegStatus {
  option (gogoproto.goproto_enum_prefix) = false;

  DKG_REG_STATUS_UNSPECIFIED = 0 [(gogoproto.enumvalue_customname) = "DKGRegStatusUnspecified"];
  DKG_REG_STATUS_VERIFIED = 2 [(gogoproto.enumvalue_customname) = "DKGRegStatusVerified"];
  DKG_REG_STATUS_NETWORK_SET = 3 [(gogoproto.enumvalue_customname) = "DKGRegStatusNetworkSet"];
  DKG_REG_STATUS_FINALIZED = 4 [(gogoproto.enumvalue_customname) = "DKGRegStatusFinalized"];
}

enum DKGStage {
  option (gogoproto.goproto_enum_prefix) = false;

  DKG_STAGE_UNSPECIFIED = 0 [(gogoproto.enumvalue_customname) = "DKGStageUnspecified"];
  DKG_STAGE_REGISTRATION = 1 [(gogoproto.enumvalue_customname) = "DKGStageRegistration"];
  DKG_STAGE_NETWORK_SET = 2 [(gogoproto.enumvalue_customname) = "DKGStageNetworkSet"];
  DKG_STAGE_NETWORK_SET_COMPLETED = 3 [(gogoproto.enumvalue_customname) = "DKGStageNetworkSetCompleted"];
  DKG_STAGE_DEALING = 4 [(gogoproto.enumvalue_customname) = "DKGStageDealing"];
  DKG_STAGE_FINALIZATION = 5 [(gogoproto.enumvalue_customname) = "DKGStageFinalization"];
  DKG_STAGE_ACTIVE = 6 [(gogoproto.enumvalue_customname) = "DKGStageActive"];
}

message DKGNetwork {
  bytes mrenclave = 1 [
    (gogoproto.moretags) = "yaml:\"mrenclave\""
  ];

  uint32 round = 2 [
    (gogoproto.moretags) = "yaml:\"round\""
  ];

  int64 start_block = 3 [
    (gogoproto.moretags) = "yaml:\"start_block\""
  ];

  // list of active validators' evm addresses
  repeated string active_val_set = 4 [
    (gogoproto.moretags) = "yaml:\"active_val_set\""
  ];

  uint32 total = 5 [
    (gogoproto.moretags) = "yaml:\"total\""
  ];

  uint32 threshold = 6 [
    (gogoproto.moretags) = "yaml:\"threshold\""
  ];

  DKGStage stage = 7 [
    (gogoproto.moretags) = "yaml:\"stage\""
  ];
}

message DKGRegistration {
  bytes mrenclave = 1 [
    (gogoproto.moretags) = "yaml:\"mrenclave\""
  ];

  uint32 round = 2 [
    (gogoproto.moretags) = "yaml:\"round\""
  ];

  string msg_sender = 3 [
    (gogoproto.moretags) = "yaml:\"msg_sender\""
  ];

  uint32 index = 4 [
    (gogoproto.moretags) = "yaml:\"index\""
  ];

  bytes dkg_pub_key = 5 [
    (gogoproto.moretags) = "yaml:\"dkg_pub_key\""
  ];

  bytes comm_pub_key = 6 [
    (gogoproto.moretags) = "yaml:\"comm_pub_key\""
  ];

  bytes raw_quote = 7 [
    (gogoproto.moretags) = "yaml:\"raw_quote\""
  ];

  DKGRegStatus status = 8 [
    (gogoproto.moretags) = "yaml:\"status\""
  ];
}

message TEEUpgradeInfo {
  bytes mrenclave = 1 [
    (gogoproto.moretags) = "yaml:\"mrenclave\""
  ];

  int64 activation_height = 2 [
    (gogoproto.moretags) = "yaml:\"activation_height\""
  ];
}


message EncryptedDeal {
  bytes dh_key = 1 [
    (gogoproto.moretags) = "yaml:\"dh_key\""
  ];

  bytes signature = 2 [
    (gogoproto.moretags) = "yaml:\"signature\""
  ];

  bytes nonce = 3 [
    (gogoproto.moretags) = "yaml:\"nonce\""
  ];

  bytes cipher = 4 [
    (gogoproto.moretags) = "yaml:\"cipher\""
  ];
}

message Deal {
  uint32 index = 1 [
    (gogoproto.moretags) = "yaml:\"index\""
  ];

  uint32 recipient_index = 2 [
    (gogoproto.moretags) = "yaml:\"recipient_index\""
  ];

  EncryptedDeal deal = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.moretags) = "yaml:\"deal\""
  ];

  bytes signature = 4 [
    (gogoproto.moretags) = "yaml:\"signature\""
  ];
}

message Complaint {
  uint32 dealer_index = 1 [
    (gogoproto.moretags) = "yaml:\"dealer_index\""
  ];

  bytes signature = 2 [
    (gogoproto.moretags) = "yaml:\"signature\""
  ];
}
